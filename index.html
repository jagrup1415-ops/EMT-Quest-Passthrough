<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>TetraGraph AR Guide — Quest 3</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script>
    // Request WebXR optional features for AR-like passthrough and hand interactions
    AFRAME.registerSystem('xr-features', {
      init() {
        const scene = this.sceneEl;
        scene.setAttribute('webxr', 'optionalFeatures: dom-overlay, hit-test; overlayElement: #hud');
        scene.setAttribute('renderer', 'colorManagement: true');
      }
    });
  </script>
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <div id="hud" class="hud">
    <div class="row">
      <label>PDF Link:</label>
      <input id="pdfUrl" type="url" value="/guide.pdf">
      <button id="loadPdf">Load</button>
    </div>
    <div class="row">
      <label>AI:</label>
      <select id="provider">
        <option value="gemini">Gemini</option>
        <option value="openai">OpenAI</option>
      </select>
      <button id="askBtn">🎙️ Hold to Ask</button>
      <button id="muteBtn">🔈 Mute TTS</button>
      <span id="status"></span>
    </div>
  </div>

  <a-scene xr-features embedded vr-mode-ui="enabled: true">
    <a-assets>
      <canvas id="page1"></canvas>
      <canvas id="page2"></canvas>
      <canvas id="page3"></canvas>
    </a-assets>

    <!-- Floating panels with slight curve/tilt for readability -->
    <a-entity id="guide" position="0 1.5 -1.2">
      <a-plane id="p1" material="src: #page1" width="0.65" height="0.85" position="-0.7 0 0" rotation="0 0 0" class="interact"></a-plane>
      <a-plane id="p2" material="src: #page2" width="0.65" height="0.85" position="0 0 0" rotation="0 0 0" class="interact"></a-plane>
      <a-plane id="p3" material="src: #page3" width="0.65" height="0.85" position="0.7 0 0" rotation="0 0 0" class="interact"></a-plane>

      <!-- Voice assistant bubble -->
      <a-entity id="assistant" position="0 -0.7 0">
        <a-circle radius="0.09"></a-circle>
        <a-text id="assistantText" value="Hold 🎙️ and ask about the guide..." align="center" width="2.2" position="0 -0.18 0"></a-text>
      </a-entity>
    </a-entity>

    <!-- Cursor for controller/gaze clicking -->
    <a-entity camera look-controls>
      <a-entity cursor="fuse: false; rayOrigin: mouse"></a-entity>
    </a-entity>
  </a-scene>

  <!-- PDF.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.4.168/pdf.min.js" integrity="sha512-fPiEoY+5O3H3G7VEE1whKlWcRa9iZ6uHpxCBxG+NHgHGAgVgKI4ci2U3d9FQ6pR6v0s2ybi8xT3gYbm1Ew2mMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="./app.js"></script>
</body>
</html>
